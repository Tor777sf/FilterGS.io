<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google Sheet CSV</title>
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css">
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>

<table id="myDataTable" class="display">
  <!-- DataTable content will be dynamically generated here -->
</table>

<script>
  $(document).ready(function () {
    var listaCompra = []; // Array para almacenar elementos seleccionados
    var totalCompra = 0; // Variable para almacenar el total de la compra

    // Descargar y parsear el archivo CSV (Código original)
    Papa.parse('https://docs.google.com/spreadsheets/d/1X0WN5st8Bl6G6_QPtC9gS6vY4PyFR5dAjXxWU7UiOYE/export?format=csv&gid=0', {
      download: true,
      header: true,
      dynamicTyping: true,
      complete: function (results) {
        // Crear DataTable (Código original)
        $('#myDataTable').DataTable({
          data: results.data,
          columns: Object.keys(results.data[0]).map(function(key) {
            return { data: key, title: key };
          }),
          columnDefs: [
            {
              targets: 10,
              render: function (data, type, row) {
                // Personalizar renderizado para la columna con enlaces no vacíos (Código original)
                return data && data !== "" ? '<a href="' + data + '" target="_blank"><img src="ruta_del_icono.png" alt="Ver Foto" /></a>' : "";
              }
            },
            // Nueva columna para el botón de agregar al carrito (Línea nueva)
          {
        targets: -1, // Última columna (Modificado)
        render: function (data, type, row) {
          // Personalizar renderizado para la columna con botón de agregar al carrito (Modificado)
          return '<button class="addToCartBtn">Agregar al carrito</button>';
        }

        });

        // Agregar evento de clic para el botón de agregar al carrito (Líneas nuevas)
        $('#myDataTable tbody').on('click', '.addToCartBtn', function () {
          var data = $('#myDataTable').DataTable().row($(this).parents('tr')).data();

          // Extraer descripción y precio del ítem seleccionado
          var descripcion = data[1];
          var precio = parseFloat(data[9]); // Convertir a número si es necesario

          // Lógica para agregar el ítem a la lista de compra
          listaCompra.push({ descripcion: descripcion, precio: precio });

          // Actualizar el total de la compra
          totalCompra += precio;

          // Puedes mostrar o actualizar el total en algún lugar de tu interfaz
          // Ejemplo: $('#totalCompra').text('Total: ' + totalCompra.toFixed(2));
        });
      }
    });
  });
</script>

</body>
</html>
